{% extends "base.html" %}

{% block content %}

<div class="card" style="max-width: 800px; margin: 0 auto;">
    <h1>{{ profile_user.get_display_name }}'s Profile</h1>

    <div style="display:flex; align-items:center; gap:2rem; margin-top:1rem;">
        
        {% if profile_user.profile_images %}
            <img src="{{ profile_user.profile_images.url }}" 
                 alt="Profile Picture"
                 style="width:150px;height:150px;border-radius:50%;object-fit:cover;">
        {% else %}
            <div style="width:150px;height:150px;border-radius:50%;background:#eee;
                        display:flex;align-items:center;justify-content:center;font-size:3rem;color:#999;">
                ?
            </div>
        {% endif %}

        <div>
            <p><strong>Name:</strong> {{ profile_user.get_display_name }}</p>
            <p><strong>Email:</strong> {{ profile_user.email }}</p>
            <p><strong>Phone:</strong> {{ profile_user.phone|default:"Not provided" }}</p>
            <p><strong>Bio:</strong> {{ profile_user.bio|default:"No bio yet." }}</p>

            {% if avg_rating %}
                <p><strong>Rating:</strong>
                    {% for i in "12345" %}
                        {% if i|int <= avg_rating %}
                            â­
                        {% else %}
                            â˜†
                        {% endif %}
                    {% endfor %}
                    <span style="color:#555;">({{ avg_rating|floatformat:1 }})</span>
                </p>
            {% else %}
                <p><strong>Rating:</strong> No reviews yet</p>
            {% endif %}
        </div>
    </div>

    <hr style="margin: 2rem 0;">

    <h3>ðŸ“¢ Reviews Received</h3>

    {% if reviews_received %}
        {% for review in reviews_received %}
            <div style="background:#f9f9f9;padding:1rem;border-radius:8px;margin-bottom:1rem;">
                
                <p><strong>From:</strong> 
                    <a href="{% url 'user_profile' review.reviewer.id %}">
                        {{ review.reviewer.get_display_name }}
                    </a>
                </p>

                <p><strong>Rating:</strong>
                    {% for i in "12345" %}
                        {% if i|int <= review.rating %}
                            â­
                        {% else %}
                            â˜†
                        {% endif %}
                    {% endfor %}
                </p>

                <p><strong>Item:</strong>
                    <a href="{% url 'marketplace:item_detail' review.transaction.item.id %}">
                        {{ review.transaction.item.title }}
                    </a>
                </p>

                <p>{{ review.comment|default:"No comment left." }}</p>

                <small style="color:#666;">
                    {{ review.created_at|date:"M d, Y" }}
                </small>
            </div>
        {% endfor %}

    {% else %}
        <p>No reviews yet.</p>
    {% endif %}

    {% if user != profile_user %}
        <a href="{% url 'messaging:start' profile_user.id %}" 
           class="btn-primary" 
           style="display:block; text-align:center; margin-top:1.5rem;">
            ðŸ’¬ Message {{ profile_user.get_display_name }}
        </a>
    {% endif %}

</div>

{% endblock %}
